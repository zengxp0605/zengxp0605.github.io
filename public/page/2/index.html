<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://zengxp0605.github.io">
  <title>Jason Zeng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="tech blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Jason Zeng">
<meta property="og:url" content="http://zengxp0605.github.io/page/2/index.html">
<meta property="og:site_name" content="Jason Zeng">
<meta property="og:description" content="tech blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jason Zeng">
<meta name="twitter:description" content="tech blog">
  
  
    <link rel="icon" href="/assets/images/favicon.png">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/assets/images/avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Jason Zeng</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Jason&#39;s personal blog</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/archives">所有文章</a></li>
	        
				<li><a href="/about">关于</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/zengxp0605" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/shopping0605" title="weibo">weibo</a>
		        
					<a class="mail" target="_blank" href="mailto:xiaoping_zeng@foxmail.com" title="mail">mail</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Jason Zeng</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/assets/images/avatar.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Jason Zeng</h1>
			</hgroup>
			
			<p class="header-subtitle">Jason&#39;s personal blog</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/about">关于</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/zengxp0605" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/shopping0605" title="weibo">weibo</a>
			        
						<a class="mail" target="_blank" href="mailto:xiaoping_zeng@foxmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-9-vscode-use" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/05/9-vscode-use/">VSCode 使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="智能提示-node-react为例"><a href="#智能提示-node-react为例" class="headerlink" title="智能提示(node,react为例)"></a>智能提示(node,react为例)</h3><ol>
<li><p>安装typings</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g typings</div></pre></td></tr></table></figure>
</li>
<li><p>进入项目目录,安装需要提示的类型(这里需要加上 <code>--global</code> 参数)  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">typings install dt~node --global</div><div class="line"></div><div class="line">// 支持react</div><div class="line">typings install dt~react --global</div><div class="line">typings install dt~react-native --global</div></pre></td></tr></table></figure>
</li>
<li><p>项目目录下新建 <code>jsconfig.json</code> 文件, 内容如下[此文件内容为空也可以??]</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"compilerOptions"</span>: &#123;</div><div class="line">    <span class="attr">"target"</span>: <span class="string">"ES6"</span>,</div><div class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</div><div class="line">    <span class="attr">"jsx"</span>: <span class="string">"react"</span>,</div><div class="line">    <span class="attr">"allowSyntheticDefaultImports"</span>: <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"exclude"</span>: [</div><div class="line">    <span class="string">"node_modules"</span></div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>新建<code>test.js</code>文件测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="comment">// 输入就能看到补全提示</span></div><div class="line">React.Component</div><div class="line"></div><div class="line">fs.readdirSync</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="另外的一种方法-通过vscode插件"><a href="#另外的一种方法-通过vscode插件" class="headerlink" title="另外的一种方法,通过vscode插件"></a>另外的一种方法,通过vscode插件</h3><ol>
<li>打开命令模式 <code>ctrl+shift+p</code></li>
<li>安装扩展,输入install</li>
<li>进入插件列表后搜索找到 <code>Typings Installer</code>,确认安装</li>
<li>安装后可以通过 <code>Typings Installer: Typings</code> 命令找到相对应的模块安装</li>
<li>如: 输入 <code>node</code>可以找到 dt~node模块, 全局安装即可</li>
<li>一定要建立 <code>jsconfig.json</code> 文件, 方可生效</li>
</ol>
<h3 id="快捷键设置-个人习惯"><a href="#快捷键设置-个人习惯" class="headerlink" title="快捷键设置(个人习惯)"></a>快捷键设置(个人习惯)</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"key"</span>: <span class="string">"ctrl+shift+down"</span>,</div><div class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.moveLinesDownAction"</span>,</div><div class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"key"</span>: <span class="string">"ctrl+shift+up"</span>,</div><div class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.moveLinesUpAction"</span>,</div><div class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"key"</span>: <span class="string">"ctrl+shift+d"</span>,</div><div class="line">        <span class="attr">"command"</span>: <span class="string">"editor.action.copyLinesDownAction"</span>,</div><div class="line">        <span class="attr">"when"</span>: <span class="string">"editorTextFocus"</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">"key"</span>: <span class="string">"shift+alt+d"</span>,</div><div class="line">        <span class="attr">"command"</span>: <span class="string">"workbench.view.debug"</span></div><div class="line">    &#125;,</div><div class="line">]</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a href="https://code.visualstudio.com/docs/languages/javascript" target="_blank" rel="external">https://code.visualstudio.com/docs/languages/javascript</a><br><a href="http://www.cnblogs.com/IPrograming/archive/2016/04/30/VsCodeTypings.html" target="_blank" rel="external">http://www.cnblogs.com/IPrograming/archive/2016/04/30/VsCodeTypings.html</a><br><a href="https://github.com/typings/typings" target="_blank" rel="external">https://github.com/typings/typings</a>  </p>
</blockquote>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/07/05/9-vscode-use/" class="archive-article-date">
  	<time datetime="2016-07-05T09:00:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-07-05</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vscode/">vscode</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/IDE/">IDE</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-3-Linux-shell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/11/3-Linux-shell/">Linux shell命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="cat-输出文件内容"><a href="#cat-输出文件内容" class="headerlink" title="cat 输出文件内容"></a>cat 输出文件内容</h3><blockquote>
<p>功能：把一个或者多个文件（或者标准输入）连接在一起，并标准输出。（Concatenate FILE(s), or standard input, to standard output.）<br>cat命令常用来显示文件内容，或者将几个文件连接起来显示，或者从标准输入读取内容并显示。它常与重定向符号配合使用。cat是Concatenate的缩写。  </p>
</blockquote>
<ul>
<li>语法：cat   [选项]   [文件]  </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">短选项 长选项 涵义</div><div class="line">-A  --show-all  等于-vET</div><div class="line">-b  --number-nonblank   对非空输出行编号</div><div class="line">-e      等于-vE</div><div class="line">-E  --show-ends 在每行结束处显示&quot;$&quot;</div><div class="line">-n  --number    对输出的所有行编号</div><div class="line">-s  --squeeze-blank 不输出多行空行</div><div class="line">-t      与-vT 等价</div><div class="line">-T  --show-tabs 将跳格字符显示为^I</div><div class="line">-v  --show-nonprinting  使用^ 和M- 引用，除了LFD和 TAB 之外</div></pre></td></tr></table></figure>
<h3 id="head-显示文件开头若干行内容"><a href="#head-显示文件开头若干行内容" class="headerlink" title="head 显示文件开头若干行内容"></a>head 显示文件开头若干行内容</h3><blockquote>
<p> 功能：head命令显示文件开头若干行（默认10行）。<br> 将每个指定文件的头10 行显示到标准输出。如果指定了多于一个文件，在每一段输出前会给出文件名作为文件头。如果不指定文件，或者文件为”-“，则从标准输入读取数据。  </p>
</blockquote>
<ul>
<li>语法：head   [选项]   [文件]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">短选项 长选项 涵义</div><div class="line">-c [-]K --bytes=[-]K    每个文件显示开头K字节。若使用了-K，则显示文件全部内容，除去最后K字节</div><div class="line">-n [-]K --lines=[-]K    每个文件显示开头K行。若使用了-K，则显示文件全部内容，除去最后K行</div><div class="line">-q  --quiet 或 --silent  不显示包含给定文件名的文件头</div><div class="line">-v  --verbose   总是显示包含给定文件名的文件头（默认）</div></pre></td></tr></table></figure>
<h3 id="tail-显示文件最后若干行内容"><a href="#tail-显示文件最后若干行内容" class="headerlink" title="tail 显示文件最后若干行内容"></a>tail 显示文件最后若干行内容</h3><blockquote>
<p> 功能：tail命令可以输出文件的尾部内容，默认情况下它显示文件的最后十行。<br> 显示每个指定文件的最后10 行到标准输出。若指定了多于一个文件，程序会在每段输出的开始添加相应文件名作为头。如果不指定文件或文件为”-“ ，则从标准输入读取数据。<br> 它常用来动态监视文件的尾部内容的增长情况，比如用来监视日志文件的变化。</p>
</blockquote>
<ul>
<li>语法：tail   [选项]   [文件]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">短选项 长选项 涵义</div><div class="line">-c [+] K    --bytes=[+] K   输出最后 K 字节；另外，使用-c +K 从每个文件的第 K 字节输出</div><div class="line">-n [+] K    --lines=[+] K   输出最后 K 行，代替最后10 行；使用-n +K 从每个文件的第 K 字节输出</div><div class="line">-f  --follow=descriptor</div><div class="line">--follow=name   descriptor是 --follow 默认值，所以 -f 等价 --follow 等价--follow=descriptor</div><div class="line">即时输出文件变化后追加的数据。</div><div class="line">tail -f file 动态跟踪文件file的增长情况，tail会每隔一秒去检查一下文件是否增加新的内容。如果增加就追加在原来的输出后面显示。但这种情况，必须保证在执行tail命令时，文件已经存在。</div><div class="line">如果想终止 tail -f 输出，按 Ctrl+C 中断tail程序。如果按Ctrl+C不能中断输出，那么可以在别的终端上执行 killall tail 强行终止。</div><div class="line">    --pid=PID   同 -f 使用，当 PID 所对应的进程死去后，终止。</div><div class="line">    ---retry    即使目标文件不可访问依然试图打开；在与参数-f 或 --follow=name 同时使用时常常有用。</div><div class="line">-F  --follow=name --retry   与 -f 相同，也是动态跟踪文件的变化，不同的是执行此命令时文件可以不存在。</div><div class="line">    --max-unchanged-stats=N N 默认为5，使用--follow=name，重新打开一个在 N 次迭代后没有改变大小的文件来看它是否被解除连接或重命名（这是循环日志文件的通常情况）。</div><div class="line">由于有inotify，这个选项很少使用。</div><div class="line">-s S    --sleep-interval=S  与 -f 合用,表示在每次反复的间隔休眠 S 秒</div><div class="line">对于 --pid=PID ，每隔 S 秒检查进程。</div><div class="line">-q  --quiet 或 --silent  不输出文件名</div><div class="line">-v  --verbose   总是输出给出文件名的首部</div></pre></td></tr></table></figure>
<h3 id="wc-统计文件行数"><a href="#wc-统计文件行数" class="headerlink" title="wc 统计文件行数"></a>wc 统计文件行数</h3><blockquote>
<p>说明：该命令统计给定文件中的字节数、字数、行数。如果没有给出文件名，则从标准输入读取。wc同时也给出所有指定文件的总统计数。字是由空格字符区分开的最大字符串。</p>
</blockquote>
<ul>
<li>语法：wc  [选项]  [文件]</li>
</ul>
<p>该命令各选项含义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">　　- c 统计字节数。</div><div class="line"></div><div class="line">　　- l 统计行数。</div><div class="line"></div><div class="line">　　- w 统计字数。</div></pre></td></tr></table></figure></p>
<h3 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h3><ol>
<li><p>查看端口占用: <code>netstat -tplne</code></p>
</li>
<li><p>查看文件夹占用空间 du(disk usage)</p>
<ul>
<li><code>du -sh</code>  # 查看当前目录总共占的容量。而不单独列出各子项占用的容量</li>
<li><code>du -lh --max-depth=1</code>  # 查看当前目录下一级子文件和子目录占用的磁盘容量。</li>
</ul>
</li>
<li><p>查看设备的空间使用率: <code>df -lh</code></p>
</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/05/11/3-Linux-shell/" class="archive-article-date">
  	<time datetime="2016-05-11T07:07:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-05-11</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/Linux/">Linux</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-1-Js-EveryDay-Replacing_switch_statements_with_Object_literals" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/19/1-Js-EveryDay-Replacing_switch_statements_with_Object_literals/">每天学点js-用对象属性替换switch</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="我们怎样来提高和优化javascript里嵌套的if语句呢？"><a href="#我们怎样来提高和优化javascript里嵌套的if语句呢？" class="headerlink" title="我们怎样来提高和优化javascript里嵌套的if语句呢？"></a>我们怎样来提高和优化javascript里嵌套的if语句呢？</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (color) &#123;</div><div class="line">  <span class="keyword">if</span> (color === <span class="string">'black'</span>) &#123;</div><div class="line">    printBlackBackground();</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (color === <span class="string">'red'</span>) &#123;</div><div class="line">    printRedBackground();</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (color === <span class="string">'blue'</span>) &#123;</div><div class="line">    printBlueBackground();</div><div class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (color === <span class="string">'green'</span>) &#123;</div><div class="line">    printGreenBackground();</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    printYellowBackground();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="一种方法来提高嵌套的if语句是用switch语句。虽然它不那么啰嗦而且排列整齐，但是并不建议使用它，因为这对于调试错误很困难。"><a href="#一种方法来提高嵌套的if语句是用switch语句。虽然它不那么啰嗦而且排列整齐，但是并不建议使用它，因为这对于调试错误很困难。" class="headerlink" title="一种方法来提高嵌套的if语句是用switch语句。虽然它不那么啰嗦而且排列整齐，但是并不建议使用它，因为这对于调试错误很困难。"></a>一种方法来提高嵌套的if语句是用switch语句。虽然它不那么啰嗦而且排列整齐，但是并不建议使用它，因为这对于调试错误很困难。</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span>(color) &#123;</div><div class="line">  <span class="keyword">case</span> <span class="string">'black'</span>:</div><div class="line">    printBlackBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> <span class="string">'red'</span>:</div><div class="line">    printRedBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> <span class="string">'blue'</span>:</div><div class="line">    printBlueBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> <span class="string">'green'</span>:</div><div class="line">    printGreenBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    printYellowBackground();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="但是如果在每个语句中都有很多条件检查时该怎么办呢？这种情况下，如果我们想要不罗嗦又整洁的话，我们可以用有条件的switch。如果我们传递true给switch语句，我没变可以在每个case中使用条件语句了。"><a href="#但是如果在每个语句中都有很多条件检查时该怎么办呢？这种情况下，如果我们想要不罗嗦又整洁的话，我们可以用有条件的switch。如果我们传递true给switch语句，我没变可以在每个case中使用条件语句了。" class="headerlink" title="但是如果在每个语句中都有很多条件检查时该怎么办呢？这种情况下，如果我们想要不罗嗦又整洁的话，我们可以用有条件的switch。如果我们传递true给switch语句，我没变可以在每个case中使用条件语句了。"></a>但是如果在每个语句中都有很多条件检查时该怎么办呢？这种情况下，如果我们想要不罗嗦又整洁的话，我们可以用有条件的switch。如果我们传递true给switch语句，我没变可以在每个case中使用条件语句了。</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span>(<span class="literal">true</span>) &#123;</div><div class="line">  <span class="keyword">case</span> (<span class="keyword">typeof</span> color === <span class="string">'string'</span> &amp;&amp; color === <span class="string">'black'</span>):</div><div class="line">    printBlackBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> (<span class="keyword">typeof</span> color === <span class="string">'string'</span> &amp;&amp; color === <span class="string">'red'</span>):</div><div class="line">    printRedBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> (<span class="keyword">typeof</span> color === <span class="string">'string'</span> &amp;&amp; color === <span class="string">'blue'</span>):</div><div class="line">    printBlueBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> (<span class="keyword">typeof</span> color === <span class="string">'string'</span> &amp;&amp; color === <span class="string">'green'</span>):</div><div class="line">    printGreenBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">  <span class="keyword">case</span> (<span class="keyword">typeof</span> color === <span class="string">'string'</span> &amp;&amp; color === <span class="string">'yellow'</span>):</div><div class="line">    printYellowBackground();</div><div class="line">    <span class="keyword">break</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="但是我们应该时刻注意避免太多判断在一个条件里，尽量少的使用switch，考虑最有效率的方法：借助object。"><a href="#但是我们应该时刻注意避免太多判断在一个条件里，尽量少的使用switch，考虑最有效率的方法：借助object。" class="headerlink" title="但是我们应该时刻注意避免太多判断在一个条件里，尽量少的使用switch，考虑最有效率的方法：借助object。"></a>但是我们应该时刻注意避免太多判断在一个条件里，尽量少的使用switch，考虑最有效率的方法：借助object。</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> colorObj = &#123;</div><div class="line">  <span class="string">'black'</span>: printBlackBackground,</div><div class="line">  <span class="string">'red'</span>: printRedBackground,</div><div class="line">  <span class="string">'blue'</span>: printBlueBackground,</div><div class="line">  <span class="string">'green'</span>: printGreenBackground,</div><div class="line">  <span class="string">'yellow'</span>: printYellowBackground</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (color <span class="keyword">in</span> colorObj) &#123;</div><div class="line">  colorObj[color]();</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/19/1-Js-EveryDay-Replacing_switch_statements_with_Object_literals/" class="archive-article-date">
  	<time datetime="2016-04-19T12:30:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-19</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/每天学点js/">每天学点js</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/js/">js</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-1-Js-EveryDay-in_and_hasOwnProperty" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/18/1-Js-EveryDay-in_and_hasOwnProperty/">每天学点js-检查某对象是否有某属性</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="检查某对象是否有某属性"><a href="#检查某对象是否有某属性" class="headerlink" title="检查某对象是否有某属性"></a>检查某对象是否有某属性</h3><p>当你需要检查某属性是否存在于一个对象，你可能会这样做：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'[@tips_js](/user/tips_js)'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (myObject.name) &#123; ... &#125;</div></pre></td></tr></table></figure>
<p>这是可以的，但是你需要知道有两种原生方法可以解决此类问题。in 操作符 和 Object.hasOwnProperty，任何继承自Object的对象都可以使用这两种方法。</p>
<h4 id="看一下较大的区别"><a href="#看一下较大的区别" class="headerlink" title="看一下较大的区别"></a>看一下较大的区别</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myObject = &#123;</div><div class="line">  <span class="attr">name</span>: <span class="string">'[@tips_js](/user/tips_js)'</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line">myObject.hasOwnProperty(<span class="string">'name'</span>); <span class="comment">// true</span></div><div class="line"><span class="string">'name'</span> <span class="keyword">in</span> myObject; <span class="comment">// true</span></div><div class="line"></div><div class="line">myObject.hasOwnProperty(<span class="string">'valueOf'</span>); <span class="comment">// false, valueOf 继承自原型链</span></div><div class="line"><span class="string">'valueOf'</span> <span class="keyword">in</span> myObject; <span class="comment">// true</span></div></pre></td></tr></table></figure>
<p>两者检查属性的深度不同，换言之hasOwnProperty只在本身有此属性时返回true,而in操作符不区分属性来自于本身或继承自原型链。</p>
<p>这是另一个例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.name = <span class="string">'[@tips_js](/user/tips_js)'</span>;</div><div class="line">&#125;;</div><div class="line">myFunc.prototype.age = <span class="string">'10 days'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> user = <span class="keyword">new</span> myFunc();</div><div class="line"></div><div class="line">user.hasOwnProperty(<span class="string">'name'</span>); <span class="comment">// true</span></div><div class="line">user.hasOwnProperty(<span class="string">'age'</span>); <span class="comment">// false, 因为age来自于原型链</span></div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/18/1-Js-EveryDay-in_and_hasOwnProperty/" class="archive-article-date">
  	<time datetime="2016-04-18T12:30:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-18</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/每天学点js/">每天学点js</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/js/">js</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-1-Js-EveryDay-console.time" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/18/1-Js-EveryDay-console.time/">每天学点js-代码块性能测试</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="快速的测量javascript的性能，我们可以使用console的方法，例如"><a href="#快速的测量javascript的性能，我们可以使用console的方法，例如" class="headerlink" title="快速的测量javascript的性能，我们可以使用console的方法，例如"></a>快速的测量javascript的性能，我们可以使用console的方法，例如</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.time(label) 和 <span class="built_in">console</span>.timeEnd(label)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.time(<span class="string">"Array initialize"</span>);</div><div class="line"><span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">100</span>),</div><div class="line">    len = arr.length,</div><div class="line">    i;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">    arr[i] = <span class="keyword">new</span> <span class="built_in">Object</span>();</div><div class="line">&#125;;</div><div class="line"><span class="built_in">console</span>.timeEnd(<span class="string">"Array initialize"</span>); <span class="comment">// Outputs: Array initialize: 0.711ms</span></div></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/18/1-Js-EveryDay-console.time/" class="archive-article-date">
  	<time datetime="2016-04-18T12:00:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-18</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/每天学点js/">每天学点js</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/js/">js</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-2-Node-simple_promise" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/17/2-Node-simple_promise/">Nodejs promise的简单实现</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Promises-A-规范"><a href="#Promises-A-规范" class="headerlink" title="Promises/A 规范"></a>Promises/A 规范</h3><p>promise 表示一个最终值，该值由一个操作完成时返回。</p>
<p>promise 有三种状态：未完成 (unfulfilled)，完成 (fulfilled) 和失败 (failed)。<br>promise 的状态只能由未完成转换成完成，或者未完成转换成失败 。<br>promise 的状态转换只发生一次。</p>
<p>### </p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h4><blockquote>
<p><a href="https://cnodejs.org/topic/569c8226adf526da2aeb23fd" target="_blank" rel="external">https://cnodejs.org/topic/569c8226adf526da2aeb23fd</a>  </p>
</blockquote>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/17/2-Node-simple_promise/" class="archive-article-date">
  	<time datetime="2016-04-17T01:23:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-17</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/promise/">promise</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/nodejs/">nodejs</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-2-Node-modules_q_2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/14/2-Node-modules_q_2/">Nodejs q模块使用2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>nodejs中promise一直使用的是<a href="https://github.com/kriskowal/q" target="_blank" rel="external">Q模块</a>,对于循环和递归的实现却折腾了好一会儿才想明白…</p>
<h3 id="promise-循环"><a href="#promise-循环" class="headerlink" title="promise 循环"></a>promise 循环</h3><ul>
<li>使用拼接then的方式, arr中的函数将依次按照顺序执行, 最后的 result只能拿到arr中最后一个函数的结果  </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> test = &#123;&#125;;</div><div class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'underscore'</span>);</div><div class="line"><span class="keyword">var</span> tableList = []; <span class="comment">// 存储id, 相当于redis 的一个set</span></div><div class="line"></div><div class="line"><span class="comment">// 测试创建桌子</span></div><div class="line">test.createTable = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    _getUniqTableId().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'result: '</span>, result );</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'--------------------------'</span>);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'tableList: '</span>, tableList.join(<span class="string">','</span>) ,<span class="string">' len: '</span> + tableList.length);</div><div class="line">    &#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'&#123;test.createTable&#125;,error: '</span> + error);</div><div class="line">    &#125;).done(); </div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 获取当前不存在的id</span></div><div class="line"><span class="keyword">var</span> _getUniqTableId = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> arr = [];</div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(i++ == <span class="number">15</span>)  <span class="keyword">break</span>; <span class="comment">// 测试的次数</span></div><div class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">_i</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> id = _.random(<span class="number">0</span> ,<span class="number">10</span>);</div><div class="line">            arr[_i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> _isIdExists(id, _i);</div><div class="line">            &#125;; </div><div class="line">        &#125;)(i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> _p = Q(<span class="number">0</span>);</div><div class="line">    arr.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>&#123;</div><div class="line">        _p = _p.then(f).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'rs: '</span> ,rs);  </div><div class="line">            <span class="keyword">return</span> rs;  </div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> _p;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 模拟redis 中异步判断id 是否存在于 set中</span></div><div class="line"><span class="comment">// 假设查询需要耗费 500 毫秒</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_isIdExists</span>(<span class="params">id, _i</span>)</span>&#123;   </div><div class="line">    <span class="keyword">var</span> deferred = Q.defer();</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> isExists = _.contains(tableList, id);</div><div class="line">        <span class="keyword">if</span>(!isExists)&#123;</div><div class="line">            tableList.push(id);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'tableList: '</span>, _i ,<span class="string">'-&gt;'</span>, tableList.join(<span class="string">','</span>));</div><div class="line">        deferred.resolve(&#123;<span class="attr">id</span>: id, <span class="attr">isExists</span>: isExists&#125;);  <span class="comment">// true 表示存在</span></div><div class="line">    &#125;, <span class="number">500</span>); </div><div class="line"></div><div class="line">    <span class="keyword">return</span> deferred.promise;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 调用</span></div><div class="line">test.createTable();</div></pre></td></tr></table></figure>
<ul>
<li>使用Q.all , arr 中的异步方法将同时执行, 所有执行完后返回结果<br>将上面的 <code>_getUniqTableId</code> 方法重写如下: </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> _getUniqTableId = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> arr = [];</div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(i++ == <span class="number">150</span>)  <span class="keyword">break</span>; <span class="comment">// 测试的次数</span></div><div class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">_i</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> id = _.random(<span class="number">0</span> ,<span class="number">10</span>);</div><div class="line">            arr[_i] = _isIdExists(id, _i);</div><div class="line">        &#125;)(i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> Q.all(arr);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li><p>使用 reduce 的写法:  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> _getUniqTableId = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> arr = [];</div><div class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(i++ == <span class="number">150</span>)  <span class="keyword">break</span>; <span class="comment">// 测试的次数</span></div><div class="line">        (<span class="function"><span class="keyword">function</span>(<span class="params">_i</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> id = _.random(<span class="number">0</span> ,<span class="number">10</span>);</div><div class="line">            arr[_i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">return</span> _isIdExists(id, _i);</div><div class="line">            &#125;; </div><div class="line">        &#125;)(i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> initialVal = <span class="number">0</span>; <span class="comment">// 这个值这里用不到</span></div><div class="line">    <span class="keyword">return</span> arr.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">soFar, f</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> soFar.then(f).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'rs: '</span> ,rs);</div><div class="line">            <span class="keyword">return</span> rs;</div><div class="line">        &#125;);</div><div class="line">    &#125;, Q(initialVal));</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
</li>
<li><p>通过递归的方式获取tableList中不存在的id,将上面的 <code>_getUniqTableId</code> 方法重写如下:  </p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> _getUniqTableId = <span class="function"><span class="keyword">function</span>(<span class="params">_count</span>) </span>&#123;</div><div class="line">    tableList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]; <span class="comment">// 模拟已经存在的id</span></div><div class="line">    <span class="keyword">var</span> id = _.random(<span class="number">0</span>, <span class="number">10</span>);</div><div class="line">    <span class="keyword">return</span> _isIdExists(id).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(rs &amp;&amp; rs.isExists != <span class="literal">true</span>)&#123;</div><div class="line">            <span class="keyword">return</span> id;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            _count = !_count  ? <span class="number">1</span> : (_count + <span class="number">1</span>);</div><div class="line">            <span class="keyword">if</span>(_count &gt; <span class="number">3</span>)&#123;  <span class="comment">// 最多递归获取3次</span></div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'&#123;_getUniqTableId&#125;,获取唯一id的次数超过3次了!!!'</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'重复id: '</span> + id, <span class="string">' | count: '</span> + _count);</div><div class="line">            <span class="keyword">return</span> _getUniqTableId(_count);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li><strong>注: 如果这些函数是有前后依赖关系的, 最好使用拼接then 的方式</strong></li>
</ul>
<h3 id="基础写法"><a href="#基础写法" class="headerlink" title="基础写法"></a>基础写法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"><span class="keyword">var</span> _ = <span class="built_in">require</span>(<span class="string">'underscore'</span>);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 返回是否已锁, true: 已锁, false: 未锁</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setLock</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> isLock = _.random(<span class="number">0</span>, <span class="number">1</span>);  <span class="comment">// 随机值模拟锁</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'isLock: '</span>, isLock);</div><div class="line">    <span class="keyword">var</span> defer = Q.defer();</div><div class="line">    <span class="keyword">if</span>(isLock === <span class="number">1</span>)&#123;</div><div class="line">        <span class="comment">//throw new Error('It is locked.');</span></div><div class="line">        defer.resolve(<span class="literal">true</span>); <span class="comment">// 已锁</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        defer.resolve(<span class="literal">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> defer.promise;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">setLock().then(<span class="function"><span class="keyword">function</span>(<span class="params">isLock</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(isLock)&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'已锁!'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'test1'</span>);</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err1</span>)</span>&#123;</div><div class="line">    <span class="comment">// 这个then 前面跑出的错误会在这里处理掉, 然后继续执行下面的then</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'err1:'</span>, err1);</div><div class="line">&#125;)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'test2'</span>);</div><div class="line">&#125;)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'test3'</span>);</div><div class="line">    <span class="comment">// 这个错误会被catch, 而后面test4 不会执行</span></div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'test3-ERR'</span>);  </div><div class="line">&#125;)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'test4'</span>);</div><div class="line">&#125;)</div><div class="line"><span class="comment">// 下面的catch 和fail 哪个写在前面,error时会执行哪个, done 则都会执行</span></div><div class="line">.catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'catch: '</span>, err);</div><div class="line">&#125;)</div><div class="line">.fail(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'fail: '</span>, err);</div><div class="line">&#125;)</div><div class="line">.done(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'done....'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="疑问"><a href="#疑问" class="headerlink" title="疑问:"></a>疑问:</h4><ul>
<li>fail 和 catch 区别??</li>
<li>如何中断, 不执行后面的then, throw Error 或者then嵌套除外</li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/14/2-Node-modules_q_2/" class="archive-article-date">
  	<time datetime="2016-04-14T11:00:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-14</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/promise/">promise</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/nodejs/">nodejs</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-2-Node-modules_q_1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/14/2-Node-modules_q_1/">Nodejs q模块使用1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="promise简单使用"><a href="#promise简单使用" class="headerlink" title="promise简单使用"></a>promise简单使用</h2><h4 id="链式操作"><a href="#链式操作" class="headerlink" title="链式操作"></a>链式操作</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"><span class="keyword">var</span> processChat = <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;</div><div class="line">   <span class="keyword">return</span> c.split(<span class="string">''</span>);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="keyword">var</span> processArr = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</div><div class="line">   <span class="keyword">return</span> arr.join(<span class="string">' || '</span>);</div><div class="line">&#125;</div><div class="line">Q.fcall(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="string">'aaa'</span>;</div><div class="line">&#125;).then(processChat).then(processArr)    <span class="comment">// 连续处理上一个方法中返回的 'aaa'</span></div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">'rs: '</span> , rs);      <span class="comment">//  rs:  a || a || a</span></div><div class="line">&#125;)</div><div class="line">.done();</div></pre></td></tr></table></figure>
<h4 id="all-的写法"><a href="#all-的写法" class="headerlink" title="all 的写法"></a>all 的写法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventually</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> Q.delay(value, <span class="number">2100</span>); <span class="comment">// === Q(value).delay(2000);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">Q.all([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].map(eventually))</div><div class="line">.done(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(result);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">Q.all([</div><div class="line">    eventually(<span class="number">10</span>),</div><div class="line">    eventually(<span class="number">20</span>)</div><div class="line">])</div><div class="line">.spread(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x, y);</div><div class="line">&#125;)</div><div class="line">.done();</div></pre></td></tr></table></figure>
<h4 id="all-的作用-所有的promises-执行完成后返回结果-array"><a href="#all-的作用-所有的promises-执行完成后返回结果-array" class="headerlink" title="all 的作用: 所有的promises 执行完成后返回结果(array)"></a>all 的作用: 所有的promises 执行完成后返回结果(array)</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun1 = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> Q.delay(<span class="number">3000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> v  + <span class="number">1</span>;</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun2 = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> v * <span class="number">2</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> errFun = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> Q.delay(<span class="number">5000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Test Error!'</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Q.all([</div><div class="line">    testFun1(<span class="number">10</span>),</div><div class="line">    testFun2(<span class="number">20</span>),</div><div class="line">    <span class="comment">//errFun(30),</span></div><div class="line">])</div><div class="line">.spread(<span class="function"><span class="keyword">function</span> (<span class="params">x, y</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x, y);</div><div class="line">    <span class="keyword">return</span> Q.delay(<span class="string">'test msg'</span>, <span class="number">5000</span>);</div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'delay 5s message: '</span>+ rs);</div><div class="line">&#125;)</div><div class="line">.catch(<span class="built_in">console</span>.error)</div><div class="line">.done(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'done....'</span>);</div><div class="line">    clearInterval(timer);  <span class="comment">// 执行完毕清除倒计时</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 计时器,用于显示效果</span></div><div class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</div><div class="line"><span class="keyword">var</span> timer = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(++ count);</div><div class="line">&#125;, <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<h3 id="any"><a href="#any" class="headerlink" title="any"></a>any</h3><p>any 的作用是 promises 数组中,哪个方法先执行完就返回该方法的结果, 只有所有的返回都是rejected 才会rejected<br><code>[Error: Can&#39;t get fulfillment value from any promise, all promises were rejected.]</code><br>如果有提早抛出错误, 则进入catch 代码段</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun1 = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> deferred = Q.defer();</div><div class="line">    Q.delay(<span class="number">3000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">// 这里如果抛出错误, 会由后面的fail捕获</span></div><div class="line">        <span class="comment">//throw new Error('someErr!');</span></div><div class="line">        <span class="comment">//deferred.reject('Test Error1');</span></div><div class="line">        deferred.resolve(v + <span class="number">1</span>);</div><div class="line">    &#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'&#123;testFun1&#125;,error: '</span> + err);</div><div class="line">    &#125;).done();</div><div class="line">    <span class="keyword">return</span> deferred.promise;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> testFun2 = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> deferred = Q.defer();</div><div class="line">    Q.delay(<span class="number">2000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//deferred.reject('Test Error2');</span></div><div class="line">        deferred.resolve(v * <span class="number">2</span>);</div><div class="line">    &#125;).done();</div><div class="line">    <span class="keyword">return</span> deferred.promise;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> errFun = <span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> deferred = Q.defer();</div><div class="line">    Q.delay(<span class="number">1000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        deferred.reject(<span class="string">'Test Error3'</span>);</div><div class="line">    &#125;).done();</div><div class="line">    <span class="keyword">return</span> deferred.promise;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Q.any([</div><div class="line">    testFun1(<span class="number">10</span>),</div><div class="line">    testFun2(<span class="number">20</span>),</div><div class="line">    errFun(<span class="number">30</span>),</div><div class="line">])</div><div class="line">.then(<span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(x);</div><div class="line">&#125;).catch(<span class="built_in">console</span>.info)</div><div class="line">.done();</div></pre></td></tr></table></figure>
<h4 id="delay-延时操作-封装-setTimeout"><a href="#delay-延时操作-封装-setTimeout" class="headerlink" title="delay 延时操作, 封装 setTimeout"></a>delay 延时操作, 封装 <code>setTimeout</code></h4><ul>
<li>下面的两种写法是一样的</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> value = <span class="string">'value string...'</span>;</div><div class="line">Q(value).delay(<span class="number">2000</span>).done(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(rs);  <span class="comment">// 这里会输出 value</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">Q.delay(<span class="number">2000</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'origin string'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>还可以使用下面的写法  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventually</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> Q.delay(value, <span class="number">2100</span>); <span class="comment">// === Q(value).delay(2000);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">eventually(<span class="string">'My name is Jason'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">rs</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(rs);</div><div class="line">&#125;).done();</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p><strong>then 后面一定要有done, 或者加上catch/fail </strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Q.fcall(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;)</div><div class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="number">111</span>, a);</div><div class="line">&#125;)</div><div class="line"><span class="comment">//.done();   // 这里的done 一定要写,或者加上catch/fail, 否则错误将会湮灭, 无法追踪</span></div></pre></td></tr></table></figure>
<p><strong>如果是需要返回promise, 供别人继续then 调用的话, 则不可以写done, 可以有cacth/fail </strong></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/14/2-Node-modules_q_1/" class="archive-article-date">
  	<time datetime="2016-04-14T10:00:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-14</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/promise/">promise</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/nodejs/">nodejs</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-2-Node-modules_redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/14/2-Node-modules_redis/">Nodejs redis模块使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-通用命令"><a href="#1-通用命令" class="headerlink" title="1. 通用命令"></a>1. 通用命令</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> redis = <span class="built_in">require</span>(<span class="string">'redis'</span>).createClient(<span class="number">6379</span>,<span class="string">'127.0.0.1'</span>);</div><div class="line"></div><div class="line">redis.info(<span class="function"><span class="keyword">function</span>(<span class="params">err, response</span>)</span>&#123;</div><div class="line">    <span class="comment">//console.log(err, response);</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 普通命令set/ get</span></div><div class="line">redis.set(<span class="string">'aaa'</span>, <span class="number">111111</span>);</div><div class="line">redis.get(<span class="string">'aaa'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, reply</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(reply);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 添加过期时间</span></div><div class="line">redis.set(<span class="string">'key'</span>, <span class="string">'datas exprie 5 minute'</span>, <span class="string">'EX'</span>, <span class="number">60</span> * <span class="number">5</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, rs</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'-----------------------------'</span>);</div><div class="line">    <span class="built_in">console</span>.log(err, rs);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'-----------------------------'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="2-简述node-redis-模块-publish-subscribe-的使用"><a href="#2-简述node-redis-模块-publish-subscribe-的使用" class="headerlink" title="2. 简述node_redis 模块 publish/subscribe 的使用"></a>2. 简述node_redis 模块 <code>publish/subscribe</code> 的使用</h3><h4 id="服务端发布-publish"><a href="#服务端发布-publish" class="headerlink" title="服务端发布 publish"></a>服务端发布 publish</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> redis = <span class="built_in">require</span>(<span class="string">'redis'</span>).createClient(<span class="number">6379</span>,<span class="string">'127.0.0.1'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 发布频道</span></div><div class="line">redis.publish(<span class="string">'first'</span>, <span class="string">'【first】: news 1'</span>);</div><div class="line">redis.publish(<span class="string">'first'</span>, <span class="string">'【first】: news 2'</span>);</div><div class="line">redis.publish(<span class="string">'second'</span>,<span class="string">'【second】： test ...'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 3秒后自动退出发布</span></div><div class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'quit publish'</span>);</div><div class="line">    redis.quit();</div><div class="line">&#125;, <span class="number">3000</span>);</div></pre></td></tr></table></figure>
<h4 id="客户端订阅"><a href="#客户端订阅" class="headerlink" title="客户端订阅"></a>客户端订阅</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 订阅频道</span></div><div class="line"><span class="comment">//  subscribe first second</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> client = <span class="built_in">require</span>(<span class="string">'redis'</span>).createClient(<span class="number">6379</span>,<span class="string">'127.0.0.1'</span>);</div><div class="line"><span class="keyword">var</span> msg_count = <span class="number">0</span>;</div><div class="line"> </div><div class="line">client.on(<span class="string">"subscribe"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">channel, count</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'client: 订阅了频道-'</span> , channel, <span class="string">' |当前频道数量'</span>, count);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"></div><div class="line">client.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">channel, message</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"Sub channel "</span> + channel + <span class="string">": "</span> + message);</div><div class="line">    msg_count ++;</div><div class="line">    <span class="keyword">if</span> (msg_count === <span class="number">3</span>) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'收到3条消息, 自动退出订阅!'</span>);</div><div class="line">        client.unsubscribe();</div><div class="line">        client.quit();</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">client.subscribe(<span class="string">'first'</span>, <span class="string">'second'</span>);</div></pre></td></tr></table></figure>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/14/2-Node-modules_redis/" class="archive-article-date">
  	<time datetime="2016-04-14T09:00:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-14</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/nodejs/">nodejs</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-1-Js-EveryDay-call_and_apply" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/13/1-Js-EveryDay-call_and_apply/">每天学点js-call和apply</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="apply-amp-call"><a href="#apply-amp-call" class="headerlink" title="apply &amp; call"></a>apply &amp; call</h3><ul>
<li>call方法:   <code>call([thisObj[,arg1[, arg2[, [,.argN]]]]])</code> </li>
<li>apply方法： <code>apply([thisObj[,argArray]])</code></li>
</ul>
<p>在 javascript 中，call 和 apply 都是为了改变某个函数运行时的上下文（context）而存在的，换句话说，就是为了改变函数体内部 this 的指向。</p>
<p>JavaScript 的一大特点是，函数存在「定义时上下文」和「运行时上下文」以及「上下文是可以改变的」这样的概念。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fruits</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  </div><div class="line">fruits.prototype = &#123;</div><div class="line">    <span class="attr">color</span>: <span class="string">"red"</span>,</div><div class="line">    <span class="attr">say</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"My color is "</span> + <span class="keyword">this</span>.color);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">  </div><div class="line"><span class="keyword">var</span> apple = <span class="keyword">new</span> fruits;</div><div class="line">apple.say();    <span class="comment">//My color is red</span></div></pre></td></tr></table></figure>
<p>但是如果我们有一个对象<code>banana= {color : &quot;yellow&quot;}</code> ,我们不想对它重新定义 say 方法，那么我们可以通过 call 或 apply 用 apple 的 say 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">banana = &#123;</div><div class="line">    <span class="attr">color</span>: <span class="string">"yellow"</span></div><div class="line">&#125;</div><div class="line">apple.say.call(banana);     <span class="comment">//My color is yellow</span></div><div class="line">apple.say.apply(banana);    <span class="comment">//My color is yellow</span></div></pre></td></tr></table></figure>
<p>所以，可以看出 call 和 apply 是为了动态改变 this 而出现的，当一个 object 没有某个方法（本栗子中banana没有say方法），但是其他的有（本栗子中apple有say方法），我们可以借助call或apply用其它对象的方法来操作。</p>
<h3 id="实现继承"><a href="#实现继承" class="headerlink" title="实现继承"></a>实现继承</h3><ol>
<li><p>单继承  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">name</span>)</span>&#123;      </div><div class="line">    <span class="keyword">this</span>.name = name;      </div><div class="line">    <span class="keyword">this</span>.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;      </div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);      </div><div class="line">    &#125;      </div><div class="line">&#125;      </div><div class="line">    </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cat</span>(<span class="params">name</span>)</span>&#123;    </div><div class="line">    Animal.call(<span class="keyword">this</span>, name);    </div><div class="line">&#125;      </div><div class="line">    </div><div class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> Cat(<span class="string">"Black Cat"</span>);   </div><div class="line">cat.showName();   <span class="comment">// Black Cat</span></div></pre></td></tr></table></figure>
</li>
<li><p>多重继承</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sub</span>(<span class="params"></span>)  </span>&#123;  </div><div class="line">    <span class="keyword">this</span>.showSub = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)  </span>&#123;  </div><div class="line">        <span class="built_in">console</span>.log(a-b);  </div><div class="line">    &#125;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add</span>(<span class="params"></span>)  </span>&#123;  </div><div class="line">    <span class="keyword">this</span>.showAdd = <span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)  </span>&#123;  </div><div class="line">        <span class="built_in">console</span>.log(a+b);  </div><div class="line">    &#125;  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyMath</span>(<span class="params"></span>)  </span>&#123;  </div><div class="line">    Sub.call(<span class="keyword">this</span>);  </div><div class="line">    Add.call(<span class="keyword">this</span>);  </div><div class="line">&#125; </div><div class="line"><span class="keyword">var</span> _math = <span class="keyword">new</span> MyMath();</div><div class="line">_math.showSub(<span class="number">10</span>, <span class="number">5</span>);  <span class="comment">// output: 5</span></div><div class="line">_math.showAdd(<span class="number">10</span>, <span class="number">5</span>);  <span class="comment">// output: 15</span></div></pre></td></tr></table></figure>
<ol>
<li>混合使用原型链实现继承<blockquote>
<p>参考: <a href="http://www.w3school.com.cn/js/pro_js_inheritance_implementing.asp" target="_blank" rel="external">w3school</a>  </p>
</blockquote>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ClassA</span>(<span class="params">sColor</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.color = sColor;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ClassA.prototype.sayColor = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.color);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ClassB</span>(<span class="params">sColor, sName</span>) </span>&#123;</div><div class="line">    ClassA.call(<span class="keyword">this</span>, sColor);</div><div class="line">    <span class="keyword">this</span>.name = sName;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ClassB.prototype = <span class="keyword">new</span> ClassA();</div><div class="line"></div><div class="line">ClassB.prototype.sayName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/********测试************/</span></div><div class="line"><span class="keyword">var</span> objA = <span class="keyword">new</span> ClassA(<span class="string">"blue"</span>);</div><div class="line"><span class="keyword">var</span> objB = <span class="keyword">new</span> ClassB(<span class="string">"red"</span>, <span class="string">"John"</span>);</div><div class="line">objA.sayColor();    <span class="comment">//输出 "blue"</span></div><div class="line">objB.sayColor();    <span class="comment">//输出 "red"</span></div><div class="line">objB.sayName();     <span class="comment">//输出 "John"</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(objA <span class="keyword">instanceof</span> ClassA);    <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(objA <span class="keyword">instanceof</span> ClassB);    <span class="comment">// false</span></div><div class="line"><span class="built_in">console</span>.log(objB <span class="keyword">instanceof</span> ClassA);    <span class="comment">// true</span></div><div class="line"><span class="built_in">console</span>.log(objB <span class="keyword">instanceof</span> ClassB);    <span class="comment">// true</span></div></pre></td></tr></table></figure>
<h3 id="深入理解运用apply、call"><a href="#深入理解运用apply、call" class="headerlink" title="深入理解运用apply、call"></a>深入理解运用apply、call</h3><p>  定义一个 log 方法，让它可以代理 console.log 方法，常见的解决方法是：<br>    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">msg</span>)　</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(msg);</div><div class="line">&#125;</div><div class="line">log(<span class="number">1</span>);    <span class="comment">//1</span></div><div class="line">log(<span class="number">1</span>,<span class="number">2</span>);    <span class="comment">//1</span></div></pre></td></tr></table></figure></p>
<p>  上面方法可以解决最基本的需求，但是当传入参数的个数是不确定的时候，上面的方法就失效了，这个时候就可以考虑使用 apply 或者 call，注意这里传入多少个参数是不确定的，所以使用apply是最好的，方法如下：<br>    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log.apply(<span class="built_in">console</span>, <span class="built_in">arguments</span>);</div><div class="line">&#125;;</div><div class="line">log(<span class="number">1</span>);    <span class="comment">//1</span></div><div class="line">log(<span class="number">1</span>,<span class="number">2</span>);    <span class="comment">//1 2</span></div></pre></td></tr></table></figure></p>
<p>  接下来的要求是给每一个 log 消息添加一个”(app)”的前辍，比如：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">log(&quot;hello world&quot;);    //(app)hello world</div></pre></td></tr></table></figure></p>
<p>  该怎么做比较优雅呢?这个时候需要想到arguments参数是个伪数组，通过 Array.prototype.slice.call 转化为标准数组，再使用数组方法unshift，像这样：<br>    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</div><div class="line">  args.unshift(<span class="string">'(app)'</span>);</div><div class="line">  </div><div class="line">  <span class="built_in">console</span>.log.apply(<span class="built_in">console</span>, args);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="apply、call、bind比较"><a href="#apply、call、bind比较" class="headerlink" title="apply、call、bind比较"></a>apply、call、bind比较</h3><p>那么 apply、call、bind 三者相比较，之间又有什么异同呢？何时使用 apply、call，何时使用 bind 呢。简单的一个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="attr">x</span>: <span class="number">81</span>,</div><div class="line">&#125;;</div><div class="line">  </div><div class="line"><span class="keyword">var</span> foo = &#123;</div><div class="line">    <span class="attr">getX</span>: <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'test:'</span>, a, b);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.x;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">  </div><div class="line"><span class="built_in">console</span>.log(foo.getX.bind(obj)(<span class="string">'a'</span>, <span class="string">'b'</span>));  </div><div class="line"><span class="built_in">console</span>.log(foo.getX.call(obj, <span class="string">'a'</span>, <span class="string">'b'</span>));   </div><div class="line"><span class="comment">// apply 与call的区别在于前者使用数组的方式传参 </span></div><div class="line"><span class="built_in">console</span>.log(foo.getX.apply(obj, [<span class="string">'a'</span>, <span class="string">'b'</span>]));</div></pre></td></tr></table></figure>
<p>三个输出的都是81，但是注意看使用 bind() 方法的，他后面多了对括号。</p>
<p>也就是说，区别是，当你希望改变上下文环境之后并非立即执行，而是回调执行的时候，使用 bind() 方法。而 apply/call 则会立即执行函数。</p>
<p><strong>再总结一下:</strong></p>
<ul>
<li>apply 、 call 、bind 三者都是用来改变函数的this对象的指向的；</li>
<li>apply 、 call 、bind 三者第一个参数都是this要指向的对象，也就是想指定的上下文；</li>
<li>apply 、 call 、bind 三者都可以利用后续参数传参；</li>
<li>bind 是返回对应函数，便于稍后调用；apply 、call 则是立即调用 。</li>
</ul>
<h3 id="apply传参方式的应用"><a href="#apply传参方式的应用" class="headerlink" title="apply传参方式的应用"></a>apply传参方式的应用</h3><p>对于纯数字数组，使用内置函数Math.max()和Math.min()的方法。</p>
<p>内置函数Math.max()和Math.min()可以分别找出参数中的最大值和最小值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Math</span>.max(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 4</span></div><div class="line"><span class="built_in">Math</span>.min(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>); <span class="comment">// 1</span></div></pre></td></tr></table></figure></p>
<p>这些函数对于数字组成的数组是不能用的。但是，这有一些类似地方法。</p>
<p>Function.prototype.apply()让你可以使用提供的this与参数组成的<em>数组(array)</em>来调用函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</div><div class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, numbers) <span class="comment">// 4</span></div><div class="line"><span class="built_in">Math</span>.min.apply(<span class="literal">null</span>, numbers) <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<p>给apply()第二个参数传递numbers数组，等于使用数组中的所有值作为函数的参数。</p>
<p>一个更简单的，基于ES2015的方法来实现此功能，是使用展开运算符.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</div><div class="line"><span class="built_in">Math</span>.max(...numbers) <span class="comment">// 4</span></div><div class="line"><span class="built_in">Math</span>.min(...numbers) <span class="comment">// 1</span></div></pre></td></tr></table></figure></p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><blockquote>
<p><a href="http://www.admin10000.com/document/6711.html" target="_blank" rel="external">http://www.admin10000.com/document/6711.html</a><br><a href="https://cnodejs.org/topic/56a050ac8392272262331d62" target="_blank" rel="external">https://cnodejs.org/topic/56a050ac8392272262331d62</a><br><a href="http://uule.iteye.com/blog/1158829" target="_blank" rel="external">http://uule.iteye.com/blog/1158829</a></p>
</blockquote>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/13/1-Js-EveryDay-call_and_apply/" class="archive-article-date">
  	<time datetime="2016-04-13T12:30:00.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-13</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/每天学点js/">每天学点js</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/js/">js</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Jason Zeng
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Css/" style="font-size: 10px;">Css</a> <a href="/tags/Git/" style="font-size: 12.5px;">Git</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/js/" style="font-size: 17.5px;">js</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/memcache/" style="font-size: 10px;">memcache</a> <a href="/tags/movie/" style="font-size: 10px;">movie</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nodejs/" style="font-size: 20px;">nodejs</a> <a href="/tags/php/" style="font-size: 12.5px;">php</a> <a href="/tags/promise/" style="font-size: 15px;">promise</a> <a href="/tags/redis/" style="font-size: 12.5px;">redis</a> <a href="/tags/sublime/" style="font-size: 12.5px;">sublime</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/windows/" style="font-size: 10px;">windows</a> <a href="/tags/每天学点js/" style="font-size: 17.5px;">每天学点js</a> <a href="/tags/读书笔记/" style="font-size: 10px;">读书笔记</a> <a href="/tags/转载/" style="font-size: 12.5px;">转载</a>
    			</div>
    	</section>
    

    

    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>